<?php

/**
 * @file
 * Admin tests for Reference module.
 */

require_once(__DIR__ . '/reference.test');

 /**
  * Test for Reference admin UI.
  */
class ReferenceFieldAutocompleteTest extends ReferenceFieldTestCase {
  public static function getInfo() {
    return array(
      'name' => 'Reference autocomplete',
      'description' => 'Tests for the autocomplete callback.',
      'group' => 'Reference',
    );
  }

  public function setUp() {
    parent::setUp();
  }

  /**
   * Make a request to the reference autocomplete url and get results.
   */
  protected function referenceAutocompleteRequest($field_name, $entity_type, $bundle, $typed = '') {
    $field_instance = implode('-', array($field_name, $entity_type, $bundle));
    return $this->backdropGet('reference_autocomplete/' . $field_instance . '/' . $typed);
  }

  /**
   * Test the autocomplete responses.
   */
  public function testReferenceAutocomplete() {
    // Make sure that the autocomplete returns access denied when a field instance doesn't exist.
    $this->referenceAutocompleteRequest('not', 'real', 'data');
    $this->assertResponse(403, 'Access is denied when trying to access an invalid field instance.');
  }
}
